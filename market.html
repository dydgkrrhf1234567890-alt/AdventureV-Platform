<!DOCTYPE html>
<html>
<head>
    <title>AdventureV : Total Market</title>
    <style>
        body { background-color: #0d1117; color: #c9d1d9; font-family: 'Segoe UI', sans-serif; text-align: center; padding: 20px; }
        .card { background: #161b22; border: 1px solid #30363d; border-radius: 15px; padding: 30px; max-width: 400px; margin: 0 auto; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        h2 { color: #f2cc60; border-bottom: 2px solid #30363d; padding-bottom: 10px; }
        .balance-box { background: #0d1117; padding: 15px; border-radius: 10px; margin: 20px 0; border: 1px solid #30363d; }
        .label { font-size: 14px; color: #8b949e; }
        .value { font-size: 24px; font-weight: bold; color: #fff; }
        .crypto-value { font-size: 24px; font-weight: bold; color: #00d2ff; text-shadow: 0 0 10px rgba(0, 210, 255, 0.5); }
        .wallet-address { font-size: 11px; color: #2ea043; margin-top: 10px; word-break: break-all; background: #000; padding: 5px; border-radius: 5px; }

        .btn { 
            width: 100%; padding: 15px; font-size: 16px; font-weight: bold; 
            border: none; border-radius: 8px; cursor: pointer; transition: 0.2s; margin-top: 10px; 
            display: flex; align-items: center; justify-content: center;
        }
        .connect-btn { color: #000; background: #f6851b; } /* ì—°ê²° (ì£¼í™©) */
        .shop-btn { color: #fff; background: #1f6feb; }     /* ì‡¼í•‘ (íŒŒë‘) */
        .shop-btn:hover { background: #388bfd; transform: scale(1.02); }
        .withdraw-btn { color: #fff; background: #238636; } /* ì¶œê¸ˆ (ì´ˆë¡) */
        .withdraw-btn:hover { background: #2ea043; transform: scale(1.02); }
        .back-btn { background: transparent; border: 1px solid #8b949e; color: #8b949e; }
    </style>
</head>
<body>
    <div class="card">
        <h2>ğŸ¦Š AdventureV Exchange</h2>
        <p>ì‡¼í•‘(ê²°ì œ)ê³¼ í™˜ì „(ì¶œê¸ˆ)ì„ ë™ì‹œì—!</p>

        <div class="balance-box">
            <div class="label">ë‚´ ê²Œì„ ê³¨ë“œ (Game Gold)</div>
            <div id="myGold" class="value">0 G</div>
        </div>

        <div class="balance-box" style="border-color: #f6851b;">
            <div class="label">ë‚´ ì½”ì¸ ì§€ê°‘ (Real Crypto)</div>
            <div id="cryptoBalance" class="crypto-value">ğŸ”’ ì—°ê²° í•„ìš”</div>
            <div id="myAddress" class="wallet-address">ì§€ê°‘ì„ ì—°ê²°í•´ì£¼ì„¸ìš”</div>
        </div>

        <button class="btn connect-btn" onclick="connectWallet()">
            ğŸ¦Š 1. ì§€ê°‘ ì—°ê²° (Connect)
        </button>

        <button class="btn shop-btn" onclick="payForItem()">
            ğŸ›’ 2. ì•„ì´í…œ êµ¬ë§¤ (0.0001 ETH)
        </button>

        <button class="btn withdraw-btn" onclick="requestWithdraw()">
            ğŸ“¥ 3. ê³¨ë“œ ì¶œê¸ˆ ì‹ ì²­ (Claim)
        </button>
        
        <br>
        <button class="btn back-btn" onclick="location.href='lobby.html'">â—€ ì»¤ë§¨ë“œ ì„¼í„°ë¡œ ë³µê·€</button>
    </div>

    <script>
        // [ì„¤ì •] ì—¬ê¸°ì— ì™•ìë‹˜ì˜ ì§€ê°‘ ì£¼ì†Œë¥¼ ë„£ìœ¼ë©´, ì‡¼í•‘í•œ ëˆì´ ì™•ìë‹˜ê»˜ ë“¤ì–´ì™€ìš”!
        // ì§€ê¸ˆì€ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ 'ì ‘ì†í•œ ì‚¬ëŒ ë³¸ì¸'ì—ê²Œ ë³´ë‚´ê²Œ í•´ë’€ì–´ìš”. (ì•ˆì „ ì œì¼!)
        let adminWallet = null; 

        let currentGold = localStorage.getItem('adv_gold') ? parseInt(localStorage.getItem('adv_gold')) : 0;
        document.getElementById('myGold').innerText = currentGold + " G";
        let userAccount = null;

        async function connectWallet() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    userAccount = accounts[0];
                    adminWallet = userAccount; // (í…ŒìŠ¤íŠ¸ìš©) ëˆ ë°›ëŠ” ì‚¬ëŒ = ë‚˜ ìì‹ 

                    const balanceHex = await window.ethereum.request({ method: 'eth_getBalance', params: [userAccount, 'latest'] });
                    const balanceEth = parseInt(balanceHex, 16) / Math.pow(10, 18);
                    
                    document.getElementById('cryptoBalance').innerText = balanceEth.toFixed(4) + " ETH";
                    document.getElementById('myAddress').innerText = userAccount;
                    alert("âœ… ì—°ê²° ì™„ë£Œ!");
                } catch (error) {
                    alert("âŒ ì˜¤ë¥˜: " + error.message);
                }
            } else {
                alert("ğŸ¦Š ë©”íƒ€ë§ˆìŠ¤í¬ ì•± ë¸Œë¼ìš°ì €ì—ì„œ ì‹¤í–‰í•´ì£¼ì„¸ìš”!");
            }
        }

        // [ê¸°ëŠ¥ 1] ì‡¼í•‘í•˜ê¸° (ë‚´ ì§€ê°‘ -> ìƒì ) : ì§„ì§œ ëˆì´ ë‚˜ê°‘ë‹ˆë‹¤!
        async function payForItem() {
            if (!userAccount) return alert("ì§€ê°‘ì„ ë¨¼ì € ì—°ê²°í•´ì£¼ì„¸ìš”!");

            try {
                // 0.0001 ETH (ì•½ 300ì›) ê²°ì œ ìš”ì²­
                // *ì£¼ì˜* ì§„ì§œë¡œ ê°€ìŠ¤ë¹„(ìˆ˜ìˆ˜ë£Œ)ê°€ ë‚˜ê°‘ë‹ˆë‹¤!
                const transactionParameters = {
                    to: adminWallet, // ëˆ ë°›ì„ ì‚¬ëŒ (ì§€ê¸ˆì€ ë‚˜ ìì‹ )
                    from: userAccount, // ëˆ ë‚¼ ì‚¬ëŒ
                    value: '0x5AF3107A4000', // 0.0001 ETHë¥¼ 16ì§„ìˆ˜ë¡œ ë°”ê¾¼ ê°’
                };

                await window.ethereum.request({
                    method: 'eth_sendTransaction',
                    params: [transactionParameters],
                });
                
                alert("ğŸ›’ [ê²°ì œ ì„±ê³µ] ì•„ì´í…œ êµ¬ë§¤ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!");

            } catch (error) {
                alert("ê²°ì œ ì·¨ì†Œ/ì‹¤íŒ¨: " + error.message);
            }
        }

        // [ê¸°ëŠ¥ 2] ì¶œê¸ˆí•˜ê¸° (ê³¨ë“œ -> ë‚´ ì§€ê°‘) : ìš”ì²­ì„œë¥¼ ë³´ëƒ…ë‹ˆë‹¤!
        function requestWithdraw() {
            if (!userAccount) return alert("ì§€ê°‘ì„ ë¨¼ì € ì—°ê²°í•´ì£¼ì„¸ìš”!");
            if (currentGold <= 0) return alert("ì¶œê¸ˆí•  ê³¨ë“œê°€ ì—†ìŠµë‹ˆë‹¤!");

            if(confirm(currentGold + " Gë¥¼ ì¶œê¸ˆ ì‹ ì²­í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                alert("ğŸ‰ [ì‹ ì²­ ì™„ë£Œ] ì„œë²„ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. (ì¶”í›„ í† í° ë°œí–‰ ì‹œ ì…ê¸ˆ ì˜ˆì •)");
                localStorage.setItem('adv_gold', 0);
                document.getElementById('myGold').innerText = "0 G";
            }
        }
    </script>
</body>
</html>
